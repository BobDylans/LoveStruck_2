(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["designerModule9"],{3070:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement;t._self._c;return t._m(0)},r=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"panel-data"},[t._v("\n    注：该组件不会在页面中显示，仅用作当前面板的data参数及其相关流程配置\n  ")])])}],n=a("8d90"),o={name:"PanelData",mixins:[n["a"]]},s=o,c=(a("3526"),a("2877")),u=Object(c["a"])(s,i,r,!1,null,"bf5d8550",null);e["a"]=u.exports},"34f8":function(t,e,a){"use strict";var i=a("f28f"),r=a.n(i);r.a},3526:function(t,e,a){"use strict";var i=a("6e30"),r=a.n(i);r.a},"37c8":function(t,e,a){e.f=a("2b4c")},"3a72":function(t,e,a){var i=a("7726"),r=a("8378"),n=a("2d00"),o=a("37c8"),s=a("86cc").f;t.exports=function(t){var e=r.Symbol||(r.Symbol=n?{}:i.Symbol||{});"_"==t.charAt(0)||t in e||s(e,t,{value:o.f(t)})}},"67ab":function(t,e,a){var i=a("ca5a")("meta"),r=a("d3f4"),n=a("69a8"),o=a("86cc").f,s=0,c=Object.isExtensible||function(){return!0},u=!a("79e5")(function(){return c(Object.preventExtensions({}))}),l=function(t){o(t,i,{value:{i:"O"+ ++s,w:{}}})},d=function(t,e){if(!r(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!n(t,i)){if(!c(t))return"F";if(!e)return"E";l(t)}return t[i].i},f=function(t,e){if(!n(t,i)){if(!c(t))return!0;if(!e)return!1;l(t)}return t[i].w},h=function(t){return u&&p.NEED&&c(t)&&!n(t,i)&&l(t),t},p=t.exports={KEY:i,NEED:!1,fastKey:d,getWeak:f,onFreeze:h}},"6e30":function(t,e,a){},"7bbc":function(t,e,a){var i=a("6821"),r=a("9093").f,n={}.toString,o="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],s=function(t){try{return r(t)}catch(e){return o.slice()}};t.exports.f=function(t){return o&&"[object Window]"==n.call(t)?s(t):r(i(t))}},"7f84":function(t,e,a){"use strict";var i=a("cebc"),r=a("2f62"),n=Object(r["a"])("panelDesigner"),o=n.mapMutations;e["a"]={methods:Object(i["a"])({},o(["removeConfig"])),computed:{moduleConfig:function(){if(this.distModuleConfig)return this.distModuleConfig;var t=this.$store.state.panelDesigner[this.code].moduleConfigMap&&this.uuid&&this.$store.state.panelDesigner[this.code].moduleConfigMap[this.uuid];return t||this.metadata}},props:{uuid:{type:String,required:!0},distModuleConfig:{type:Object},code:{type:String,required:!0},projectType:{type:String,required:!0}},beforeDestroy:function(){}}},"8a81":function(t,e,a){"use strict";var i=a("7726"),r=a("69a8"),n=a("9e1e"),o=a("5ca1"),s=a("2aba"),c=a("67ab").KEY,u=a("79e5"),l=a("5537"),d=a("7f20"),f=a("ca5a"),h=a("2b4c"),p=a("37c8"),m=a("3a72"),g=a("d4c0"),v=a("1169"),y=a("cb7c"),b=a("d3f4"),C=a("4bf8"),S=a("6821"),D=a("6a99"),w=a("4630"),x=a("2aeb"),A=a("7bbc"),q=a("11e9"),O=a("2621"),M=a("86cc"),j=a("0d58"),k=q.f,_=M.f,T=A.f,P=i.Symbol,R=i.JSON,E=R&&R.stringify,L="prototype",N=h("_hidden"),$=h("toPrimitive"),W={}.propertyIsEnumerable,F=l("symbol-registry"),I=l("symbols"),B=l("op-symbols"),J=Object[L],z="function"==typeof P&&!!O.f,G=i.QObject,H=!G||!G[L]||!G[L].findChild,K=n&&u(function(){return 7!=x(_({},"a",{get:function(){return _(this,"a",{value:7}).a}})).a})?function(t,e,a){var i=k(J,e);i&&delete J[e],_(t,e,a),i&&t!==J&&_(J,e,i)}:_,Q=function(t){var e=I[t]=x(P[L]);return e._k=t,e},V=z&&"symbol"==typeof P.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof P},Y=function(t,e,a){return t===J&&Y(B,e,a),y(t),e=D(e,!0),y(a),r(I,e)?(a.enumerable?(r(t,N)&&t[N][e]&&(t[N][e]=!1),a=x(a,{enumerable:w(0,!1)})):(r(t,N)||_(t,N,w(1,{})),t[N][e]=!0),K(t,e,a)):_(t,e,a)},U=function(t,e){y(t);var a,i=g(e=S(e)),r=0,n=i.length;while(n>r)Y(t,a=i[r++],e[a]);return t},X=function(t,e){return void 0===e?x(t):U(x(t),e)},Z=function(t){var e=W.call(this,t=D(t,!0));return!(this===J&&r(I,t)&&!r(B,t))&&(!(e||!r(this,t)||!r(I,t)||r(this,N)&&this[N][t])||e)},tt=function(t,e){if(t=S(t),e=D(e,!0),t!==J||!r(I,e)||r(B,e)){var a=k(t,e);return!a||!r(I,e)||r(t,N)&&t[N][e]||(a.enumerable=!0),a}},et=function(t){var e,a=T(S(t)),i=[],n=0;while(a.length>n)r(I,e=a[n++])||e==N||e==c||i.push(e);return i},at=function(t){var e,a=t===J,i=T(a?B:S(t)),n=[],o=0;while(i.length>o)!r(I,e=i[o++])||a&&!r(J,e)||n.push(I[e]);return n};z||(P=function(){if(this instanceof P)throw TypeError("Symbol is not a constructor!");var t=f(arguments.length>0?arguments[0]:void 0),e=function(a){this===J&&e.call(B,a),r(this,N)&&r(this[N],t)&&(this[N][t]=!1),K(this,t,w(1,a))};return n&&H&&K(J,t,{configurable:!0,set:e}),Q(t)},s(P[L],"toString",function(){return this._k}),q.f=tt,M.f=Y,a("9093").f=A.f=et,a("52a7").f=Z,O.f=at,n&&!a("2d00")&&s(J,"propertyIsEnumerable",Z,!0),p.f=function(t){return Q(h(t))}),o(o.G+o.W+o.F*!z,{Symbol:P});for(var it="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),rt=0;it.length>rt;)h(it[rt++]);for(var nt=j(h.store),ot=0;nt.length>ot;)m(nt[ot++]);o(o.S+o.F*!z,"Symbol",{for:function(t){return r(F,t+="")?F[t]:F[t]=P(t)},keyFor:function(t){if(!V(t))throw TypeError(t+" is not a symbol!");for(var e in F)if(F[e]===t)return e},useSetter:function(){H=!0},useSimple:function(){H=!1}}),o(o.S+o.F*!z,"Object",{create:X,defineProperty:Y,defineProperties:U,getOwnPropertyDescriptor:tt,getOwnPropertyNames:et,getOwnPropertySymbols:at});var st=u(function(){O.f(1)});o(o.S+o.F*st,"Object",{getOwnPropertySymbols:function(t){return O.f(C(t))}}),R&&o(o.S+o.F*(!z||u(function(){var t=P();return"[null]"!=E([t])||"{}"!=E({a:t})||"{}"!=E(Object(t))})),"JSON",{stringify:function(t){var e,a,i=[t],r=1;while(arguments.length>r)i.push(arguments[r++]);if(a=e=i[1],(b(e)||void 0!==t)&&!V(t))return v(e)||(e=function(t,e){if("function"==typeof a&&(e=a.call(this,t,e)),!V(e))return e}),i[1]=e,E.apply(R,i)}}),P[L][$]||a("32e9")(P[L],$,P[L].valueOf),d(P,"Symbol"),d(Math,"Math",!0),d(i.JSON,"JSON",!0)},"8d90":function(t,e,a){"use strict";e["a"]={computed:{moduleConfig:function(){return this.value}},props:{code:{type:String,default:""},tipClass:{type:String,default:""},uuid:{type:String,default:""},value:{type:Object,default:function(){return{}}},projectType:{type:String,required:!0}}}},ac4d:function(t,e,a){a("3a72")("asyncIterator")},afcf:function(t,e,a){"use strict";a.d(e,"a",function(){return i});var i={lineChart:"line",barChart:"bar",pieChart:"pie"}},b374:function(t,e,a){"use strict";e["a"]={metadata:{datasource:{type:"entity",api:"",apiObj:{type:"get",uri:""},entity:"",columns:[],extConvertorColumns:[],seriesLayoutBy:"row",sql:"",dateRange:{enabled:!1,days:7}},chartAttr:{title:"",theme:"",height:260,chartType:"line",chartTypes:[],seriesLayoutBy:"row",boundaryGap:!0,lineProps:{smooth:!1},barProps:{barWidthType:"auto",barWidth:40}},output:{seriesArr:[],series:""}}}},b829:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("statistical-chart-index",{attrs:{uuid:t.uuid,code:t.code,"project-type":t.projectType},model:{value:t.moduleConfig,callback:function(e){t.moduleConfig=e},expression:"moduleConfig"}})],1)},r=[],n=a("7f84"),o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"title-preview-line"},[t.moduleConfig.metadata.datasource.dateRange.enabled?a("a-form-model",{staticStyle:{"margin-top":"10px"},attrs:{"label-col":{span:4},"wrapper-col":{span:14}}},[a("a-form-model-item",{attrs:{label:"日期范围"}},[a("a-range-picker",{attrs:{value:t.dateRangeValue},on:{change:t.onRangePickerChanged}})],1)],1):t._e(),a("div",{style:"height: "+t.moduleConfig.metadata.chartAttr.height+"px;",attrs:{id:"chart-"+t.uuid}}),a("a-modal",{attrs:{"dialog-style":{top:"20px"},title:"SQL优化建议"},on:{cancel:t.closeSqlAdviceModal},model:{value:t.sqlAdviceModal.visible,callback:function(e){t.$set(t.sqlAdviceModal,"visible",e)},expression:"sqlAdviceModal.visible"}},[a("div",{staticClass:"sql-advice-wrapper"},[a("div",{staticClass:"sql-advice-content"},[a("p",[t._v("您的SQL语句返回结果不符合统计图表要求，将为您进行以下替换处理！")]),a("div",{domProps:{innerHTML:t._s(t.sqlAdviceModal.content)}}),t.sqlAdviceModal.resultSql?[a("p",{staticStyle:{"font-weight":"500"}},[t._v("替换结果为：")]),a("pre",[t._v(t._s(t.sqlAdviceModal.resultSql))])]:t._e()],2)]),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("a-button",{attrs:{type:"default"},on:{click:function(e){t.sqlAdviceModal.visible=!1}}},[t._v("我自己来，谢谢！")]),2===t.sqlAdviceModal.replaceMapList.filter(function(t){return t.target.includes("axis")||t.target.includes("seriesName")}).length?a("a-button",{attrs:{type:"primary",ghost:""},on:{click:function(e){return t.autoReplaceSql(!0)}}},[t._v("维度切换")]):t._e(),a("a-button",{attrs:{type:"primary"},on:{click:function(e){return t.confirmReplaceSql()}}},[t._v("确认优化")])],1)])],1)},s=[],c=a("75fc"),u=(a("ac4d"),a("8a81"),a("a481"),a("6762"),a("2fdb"),a("ac6a"),a("456d"),a("28a5"),a("96cf"),a("3b8d")),l=a("8d90"),d=a("b374"),f=a("313e"),h=a("3aa3"),p=a("2abb"),m=a("2ef0"),g=a.n(m),v=a("afcf"),y=a("c1df"),b=a.n(y),C=a("e552").js_beautify,S={visible:!1,replaceMapList:[],content:"",resultSql:"",dimenSwitched:!1},D={name:"CommonStatisticalChart",data:function(){return{metadata:d["a"],baseData:{},myChart:{},xAxisData:[],legendData:[],datasetSource:[],option:{},sqlAdviceModal:g.a.cloneDeep(S)}},methods:{loadData:function(){var t=Object(u["a"])(regeneratorRuntime.mark(function t(){var e,a,i,r,n,o,s,c,u,l,d,f,m,g,v,y,b,C;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(e=this.moduleConfig.metadata.datasource,a=e.type,i=e.api,r=e.sql,"api"!==a){t.next=11;break}return n=i.split("_"),o=n[0].toLowerCase(),s=n[1],t.next=7,h["a"][o](s);case 7:c=t.sent,0===c.code?(this.baseData=c.data,this.parseApiData2Dataset(c.data),this.reloadChart()):4001===c.code?this.$confirm({title:"获取接口数据失败",content:function(t){return t("div",{domProps:{innerHTML:"启用数据源接口配置，需忽略权限检查。<br/>\n请将如下配置写入到后段项目配置文件中：<br/>\n<b>diboot.iam.enable-permission-check=false</b>\n<br/>\n<b>diboot.iam.anon-urls=/**</b>\n<br/>\n注意：上述配置在正式发布时需移除"}})}}):(this.baseData={},this.parseApiData2Dataset({}),this.reloadChart()),t.next=27;break;case 11:if("entity"!==a&&"sql"!==a){t.next=27;break}if(!r){t.next=24;break}if(u=this.moduleConfig.metadata.datasource.dateRange.days,u&&0!==u){t.next=16;break}return t.abrupt("return",!1);case 16:return l={sql:r,days:u},l.extConvertorColumns=this.moduleConfig.metadata.datasource.extConvertorColumns,t.next=20,p["a"].post("/diboot/devtools/db/eqs",l);case 20:d=t.sent,0===d.code&&(f=d.data,m=f.title,g=f.groupData,v=f.adviceFieldMap,y=Object.keys(v),y.length>0?(b=y.map(function(t){for(var e=["as ".concat(t),"AS ".concat(t),t],a=["as #target#","AS #target#","#origin# AS #target#"],i=0;i<e.length;i++){var n=e[i];if(r.includes(n)){var o=a[i].replace(/#target#/g,v[t]).replace(/#origin#/g,t);return{origin:n,target:o}}}}).filter(function(t){return void 0!==t}),C=b.map(function(t){var e=t.origin,a=t.target;return"<p><b>".concat(e,"</b>  ====>  <b>").concat(a,"</b></p>")}).join(""),this.sqlAdviceModal.content=C,this.sqlAdviceModal.replaceMapList=b,this.sqlAdviceModal.visible=!0,this.autoReplaceSql(!1)):(this.baseData={title:m,groupData:g},this.parseApiData2Dataset(d.data),this.reloadChart())),t.next=27;break;case 24:this.baseData={},this.parseApiData2Dataset({}),this.reloadChart();case 27:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),autoReplaceSql:function(t){var e=this.sqlAdviceModal,a=e.replaceMapList,i=e.dimenSwitched;this.sqlAdviceModal.dimenSwitched=!!t&&!i;var r=this.moduleConfig.metadata.datasource.sql;if(a.length>0){var n=!0,o=!1,s=void 0;try{for(var c,u=a[Symbol.iterator]();!(n=(c=u.next()).done);n=!0){var l=c.value,d=l.origin,f=l.target;this.sqlAdviceModal.dimenSwitched&&(f.includes(" axis")?f=f.replace(" axis"," seriesName"):f.includes(" seriesName")&&(f=f.replace(" seriesName"," axis"))),r=r.replace(d,f)}}catch(h){o=!0,s=h}finally{try{n||null==u.return||u.return()}finally{if(o)throw s}}this.sqlAdviceModal.resultSql=r}},confirmReplaceSql:function(){this.moduleConfig.metadata.datasource.sql=this.sqlAdviceModal.resultSql,this.sqlAdviceModal=g.a.cloneDeep(S)},closeSqlAdviceModal:function(){this.sqlAdviceModal=g.a.cloneDeep(S)},parseApiData2Dataset:function(t){var e=t.title,a=t.groupData;void 0!==e&&void 0!==a||(this.datasetSource=[]);var i=[],r=["product"];for(var n in r.push.apply(r,Object(c["a"])(e)),i.push(r),a){var o=[n],s=a[n].map(function(t){return"string"===typeof t?t.includes(".")?parseFloat(t):parseInt(t):t});o.push.apply(o,Object(c["a"])(s)),i.push(o)}this.datasetSource=i},parseBaseData2Dataset:function(){var t=this.baseData,e=this.moduleConfig.metadata.datasource.type;return"api"===e?this.parseApiData2Dataset(t):"sql"===e?this.parseApiData2Dataset(t):"entity"===e?this.parseApiData2Dataset(t):{}},initChart:function(){var t=this.uuid,e=f["a"](document.getElementById("chart-".concat(t)));this.myChart=e,window.onresize=function(){e.resize()}},reloadChart:function(){var t=this.chartOption;this.myChart.setOption(t)},onRangePickerChanged:function(){this.$message.info("日期筛选条件在代码生成后可用")}},computed:{barWidth:function(){var t=this.moduleConfig.metadata.chartAttr.barProps,e=t.barWidthType,a=t.barWidth;return"auto"===e?void 0:a},series:function(){var t=this.baseData,e=this.barWidth,a=t.groupData,i=t.title,r=this.moduleConfig.metadata.datasource;if(!t||!i||!a)return[];var n=this.moduleConfig.metadata.chartAttr,o=n.seriesLayoutBy,s=n.lineProps,c=this.moduleConfig.metadata.chartAttr.chartType,u=this.moduleConfig.metadata.chartAttr.chartTypes,l=[];return l="row"===o?Object.keys(a).map(function(){}):i.map(function(){}),l.map(function(t,a){"api"===r.type&&a<u.length&&(c=u[a]);var i={type:c,seriesLayoutBy:o};return"line"===c&&s.smooth&&(i.smooth=s.smooth),"bar"===c&&void 0!==e&&(i.barWidth=e),i})},chartOption:function(){var t=this.datasetSource,e=this.series,a=this.moduleConfig.metadata.chartAttr,i=a.title,r=a.boundaryGap,n=a.chartType,o={show:"pie"!==n,type:"category",gridIndex:0};"line"===n&&(o.boundaryGap=r);var s={title:{text:i},tooltip:{trigger:"axis"},dataset:{sourceHeader:!0,source:t},xAxis:o,yAxis:{},series:e};return s},outputSeries:function(){var t=this.baseData,e=this.moduleConfig.metadata.datasource;if(!t||!t.title||!t.groupData)return[];var a=t.title,i=t.groupData,r=this.moduleConfig.metadata.chartAttr.chartType,n=this.moduleConfig.metadata.chartAttr,o=n.seriesLayoutBy,s=n.lineProps,c=n.chartTypes,u=[];return u="row"===o?Object.keys(i).map(function(t,a){"api"===e.type&&a<c.length&&(r=c[a]);var i={name:t,type:r,data:"groupData['".concat(t,"']")};return s.smooth&&(i.smooth=s.smooth),i}):a.map(function(t,a){"api"===e.type&&a<c.length&&(r=c[a]);var i={name:t,type:r,data:"groupData['".concat(t,"']")};return s.smooth&&(i.smooth=s.smooth),i}),u},dateRangeValue:function(){var t=this.moduleConfig.metadata.datasource.dateRange,e=t.enabled,a=t.days;if(e&&a)return[b()().add(1-a,"d"),b()()]}},watch:{"moduleConfig.metadata.datasource":{handler:function(){var t=Object(u["a"])(regeneratorRuntime.mark(function t(e){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.loadData();case 2:this.myChart.dispose(),this.initChart(),this.reloadChart();case 5:case"end":return t.stop()}},t,this)}));function e(e){return t.apply(this,arguments)}return e}(),deep:!0,immediate:!0},"moduleConfig.metadata.datasource.dateRange.days":function(){var t=Object(u["a"])(regeneratorRuntime.mark(function t(e){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.loadData();case 2:this.myChart.dispose(),this.initChart(),this.reloadChart();case 5:case"end":return t.stop()}},t,this)}));function e(e){return t.apply(this,arguments)}return e}(),series:function(t,e){if(t.length!==e.length){for(var a=this.moduleConfig.metadata.chartAttr.chartTypes,i=[],r=0;r<t.length;r++){var n="line";n=r<a.length?a[r]:v["a"][this.moduleConfig.type],i.push(n)}this.moduleConfig.metadata.chartAttr.chartTypes=i}},chartOption:{handler:function(){this.reloadChart()},deep:!0},"moduleConfig.metadata.chartAttr.chartType":function(){this.myChart.dispose(),this.initChart(),this.reloadChart()},"moduleConfig.metadata.chartAttr.lineProps.smooth":function(t){t||(this.myChart.dispose(),this.initChart(),this.reloadChart())},"moduleConfig.metadata.chartAttr.barProps":{handler:function(t){this.$nextTick(function(){"auto"===t.barWidthType&&(this.myChart.dispose(),this.initChart(),this.reloadChart())})},deep:!0},"moduleConfig.metadata.chartAttr.height":function(t){this.myChart.resize()},outputSeries:{handler:function(t){this.moduleConfig.metadata.output.seriesArr=t;var e=JSON.stringify(t);e=e.replace(/"groupData\[/g,"groupData["),e=e.replace(/]"/g,"]"),e=C(e,{indent_size:2}),this.moduleConfig.metadata.output.series=e},deep:!0}},mixins:[l["a"]],mounted:function(){this.$nextTick(function(){this.initChart()})}},w=D,x=(a("34f8"),a("2877")),A=Object(x["a"])(w,o,s,!1,null,"194e5c7d",null),q=A.exports,O={name:"StatisticalChart",components:{statisticalChartIndex:q},mixins:[n["a"]]},M=O,j=(a("dc2c"),Object(x["a"])(M,i,r,!1,null,"e44ef3c0",null));e["default"]=j.exports},c00a:function(t,e,a){"use strict";e["a"]={computed:{moduleConfig:function(){if(this.distModuleConfig)return this.distModuleConfig;var t=this.$store.state.DragConfig[this.code].moduleConfigMap&&this.uuid&&this.$store.state.DragConfig[this.code].moduleConfigMap[this.uuid];return t||this.metadata}},props:{uuid:{type:String,required:!0},distModuleConfig:{type:Object},code:{type:String,required:!0},projectType:{type:String,required:!0}}}},d4c0:function(t,e,a){var i=a("0d58"),r=a("2621"),n=a("52a7");t.exports=function(t){var e=i(t),a=r.f;if(a){var o,s=a(t),c=n.f,u=0;while(s.length>u)c.call(t,o=s[u++])&&e.push(o)}return e}},dc2c:function(t,e,a){"use strict";var i=a("e809"),r=a.n(i);r.a},e809:function(t,e,a){},f28f:function(t,e,a){},ff56:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("panel-data-index",{attrs:{code:t.code,"project-type":t.projectType},model:{value:t.moduleConfig,callback:function(e){t.moduleConfig=e},expression:"moduleConfig"}})],1)},r=[],n=a("c00a"),o=a("3070"),s={name:"PanelData",components:{panelDataIndex:o["a"]},mixins:[n["a"]]},c=s,u=a("2877"),l=Object(u["a"])(c,i,r,!1,null,"f29d6fe6",null);e["default"]=l.exports}}]);